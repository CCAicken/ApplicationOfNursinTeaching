<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="css/amazeui.min.css" />
		<link rel="stylesheet" href="css/admin.css" />
		<link rel="stylesheet" href="layui/css/layui.css"/>
	</head>
	<style>
		body .demo-class .layui-layer-title{background:#19A97B; color:#fff; border: none;}
		body .demo-class .layui-layer-btn{border-top:1px solid #19A97B}
		body .demo-class .layui-layer-btn a{background:#19A97B;}
		body .demo-class .layui-layer-btn .layui-layer-btn1{background:#19A97B;}
		body .demo-class .layui-layer-page .layui-layer-content {background-color: #e13e4;}
		.layui-layer-content{
		    text-align:center;
		}
	</style>
	<body>
		<div class="admin-content-body">
			<div class="am-cf am-padding am-padding-bottom-0">
				<div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">病人基本信息</strong><small></small></div>
			</div>

			<hr>

			<div class="am-g">
				<div class="am-u-sm-12 am-u-md-6">
					<div class="am-btn-toolbar">
						<div class="am-btn-group am-btn-group-xs">
							<button type="button" class="am-btn am-btn-default" id="addpatient"><span class="am-icon-plus"></span>添加病人信息</button>
						</div>
					</div>
				</div>
				<div class="am-u-sm-12 am-u-md-3">

				</div>
				<div class="am-u-sm-12 am-u-md-3">
					<div class="am-input-group am-input-group-sm">
						<input type="text" class="am-form-field" id="input_wherecondition">
						<span class="am-input-group-btn">
			<button class="am-btn am-btn-default sousuo" id="btnselfrontinfo" type="button">搜索</button>
			
          </span>
					</div>
				</div>
			</div>
			<div class="am-g">
				<div class="am-u-sm-12">
					 <table id="classlist" style="text-align: center;" class="layui-table" lay-filter="tool">	</table>
				</div>
			</div>
		</div>
		<!-- 编辑 -->
		<div id="div_editcollege" style="display:none;text-align: center; margin-top: 15%;">
			<form class="layui-form layui-form-pane">
				   <div class="layui-form-item">
				    <label class="layui-form-label">病人姓名:</label> 
				    <div class="layui-input-inline">
				      <input type="text" id="oldpatName"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">职业:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldprofession"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">性别:</label>
				    <div class="layui-input-inline">
				     <select id="oldagend"  lay-filter="oldagend" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
					 </select>	
					</div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">年龄:</label>
				    <div class="layui-input-inline">
				     <input type="number" id="oldage"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">籍贯:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldorigin"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">婚姻状态:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldmarriageStatus"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">民族:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldnation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">入院时间:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldbeHospitalizedTime"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">文化程度:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="olddegreeOfEducation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">家庭地址:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldaddress"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">宗教信仰:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldreligiousBelief"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">备注:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="oldremarks"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">科室:</label>
				    <div class="layui-input-inline">
				      <select id="olddepId"  lay-filter="oldStuAgend" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
						</select>	
				    </div> 
				  </div>
  			</form>
		</div>
		<!-- 查看 -->
		<div id="div_detailcollege" style="display:none;text-align: center; margin-top: 15%;">
			<form class="layui-form layui-form-pane">
				   <div class="layui-form-item">
				    <label class="layui-form-label">病人姓名:</label> 
				    <div class="layui-input-inline">
				      <input type="text" id="detailpatName"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">职业:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailprofession"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">性别:</label>
				    <div class="layui-input-inline">
				     <select id="detailagend"  lay-filter="detailagend" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
					 </select>	
					</div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">年龄:</label>
				    <div class="layui-input-inline">
				     <input type="number" id="detailage"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">籍贯:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailorigin"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">婚姻状态:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailmarriageStatus"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">民族:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailnation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">入院时间:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailbeHospitalizedTime"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">文化程度:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detaildegreeOfEducation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">家庭地址:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailaddress"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">宗教信仰:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailreligiousBelief"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">备注:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="detailremarks"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">科室:</label>
				    <div class="layui-input-inline">
				      <select id="detaildepId"  lay-filter="detaildepId" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
						</select>	
				    </div> 
				  </div>
  			</form>
		</div>
		<!--班级添加div  -->
		<div id="div_addcollege"
			style="display: none;text-align: center; margin-top: 15%;">
			<form class="layui-form layui-form-pane">
				  <div class="layui-form-item">
				    <label class="layui-form-label">病人姓名:</label> 
				    <div class="layui-input-inline">
				      <input type="text" id="addpatName"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">职业:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addprofession"  lay-verify="required" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">性别:</label>
				    <div class="layui-input-inline">
				     <select id="addagend"  lay-filter="addagend" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
					 </select>	
					</div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">年龄:</label>
				    <div class="layui-input-inline">
				     <input type="number" id="addage"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">籍贯:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addorigin"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">婚姻状态:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addmarriageStatus"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">民族:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addnation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">入院时间:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addbeHospitalizedTime"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">文化程度:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="adddegreeOfEducation"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">家庭地址:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addaddress"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">宗教信仰:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addreligiousBelief"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">备注:</label>
				    <div class="layui-input-inline">
				     <input type="text" id="addremarks"  lay-verify="required" autocomplete="off" class="layui-input">
				    	
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">科室:</label>
				    <div class="layui-input-inline">
				      <select id="adddepId"  lay-filter="addStuAgend" lay-search> 
				      <option value="男" >男</option>
				      <option value="女" >女</option>
						</select>	
				    </div> 
				  </div>
  			</form>
		</div>
		
		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="detaill"><i class="layui-icon layui-icon-search"></i>  查看更多</a>
  			<a class="layui-btn layui-btn-xs" lay-event="edit"><span class="am-icon-pencil-square-o"></span> 编辑</a>
  			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><span class="am-icon-trash-o"></span> 删除</a>
		</script>
		<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/popup.js"></script>
		
		<script type="text/javascript" src="js/loadselect.js"></script>
		<script type="text/javascript" src="layui/layui.all.js"></script>
		
		<script>
			layui.use(['layer','form','table'], function(){
				var layer = layui.layer,$=layui.jquery,table=layui.table,form=layui.form;
				
				//loadSelect("classname","addClassId", form); 
		  		//loadSelect("tea","addclasstea", form); 
				
				/*加载表格*/
				table.render({
					elem : '#classlist',
					id:'classlist',
					url : 'patient/getpatpage',
					title : '班级数据表',
					height: "full-200",
					//skin : 'line',
					even : true,
					cols : [ 
					     [ {
							type : 'numbers',
							title : '序号',
							align : 'center',
							
						}, {
		     				field : 'patName',
		     				align : 'center',
		     				title : '姓名',
		   
		    			},{
		     				field : 'agend',
		     				align : 'center',
		     				title : '性别',
		   
		    			},{
		     				field : 'age',
		     				align : 'center',
		     				title : '年龄',
		   
		    			},{
		     				field : 'origin',
		     				align : 'center',
		     				title : '地区',
		   
		    			},{
		     				field : 'depName',
		     				align : 'center',
		     				title : '科室',
		   
		    			},{
		     				field : 'beHospitalizedTime',
		     				align : 'center',
		     				title : '入院时间',
		   
		    			},{
							title : '操作',
							toolbar : '#barDemo',
							width:300,
							align : 'center'
						}] ],
					 page: {
							layout: ['prev', 'page', 'next', 'skip', 'count', 'limit'],
							groups: 5,
							limit: 10,
							limits: [1, 4, 5, 10, 50],
							theme: '#1E9FFF',						
					 },
				});
				
				/* 点击查询对专业进行筛选 */
				$("#btnselfrontinfo").click(function() {
					table.reload('classlist', {
						method : 'post',
						where : {
							'strwhere' : $("#input_wherecondition").val().trim(),
							
								},
						page : {
							curr : 1
							}
					});
				});
				
				//表格工具栏事件 
				table.on('tool(tool)', function(obj) {
					var data = obj.data;
					switch (obj.event) {
						//查看更多
						case 'detaill':
							$("#detailpatName").val(data.patName);
					        $("#detailprofession").val(data.profession);
					        $("#detailagend").val(data.agend);
			 				$("#detailage").val(data.age);
			   				$("#detailorigin").val(data.origin);
		 					$("#detailnation").val(data.nation);
		  					$("#detailbeHospitalizedTime").val(data.beHospitalizedTime);
			 				$("#detaildegreeOfEducation").val(data.degreeOfEducation);
			  				$("#detailaddress").val(data.address);
			   				$("#detailreligiousBelief").val(data.religiousBelief);
				 			$("#detailremarks").val(data.remarks);
			  				$("#detailmarriageStatus").val(data.marriageStatus);
			   				$("#detaildepId").val()
						layer.open({
			  				title:"查看"+data.patName+"病人信息",
			  				type: 1,
			  				area: ['400px', '600px'],
			  				skin: 'demo-class',
			  				//btn:['添加'],
			  				//maxmin: true,//显示最大化最小化按钮
			  				//offset: 'b', 弹框的位置
			  				content: $('#div_detailcollege'),
			  				//btn1: function(index, layero){},
			  				cancel: function(){}
						});
						break;
						//删除按钮操作
						case 'del':
							layer.confirm('即将删除'+data.patName+',确定要删除么？', {
							  btn: ['确定','取消'],
							  icon:3
							}, function(){
								$.ajax({
					        		type: 'get',
					        		url: "patient/delpat",
					        		dataType: 'json',
					        		data:{
					        		patId:data.patId
					        		},
					        		success:function(data){
					        			if(data.code == 0){
					        				layer.confirm(data.msg, {
					        				icon: 1,
											  btn: ['确定']
											}, function(){
												table.reload("classlist", { //此处是上文提到的 初始化标识id
									                where: {
									                	
									                },page: {
									                curr:1
									                }
									            });	
												layer.closeAll();
											});          				 
					        			}
					        			else{
					        				layer.confirm(data.msg, {
					        				icon: 7,
												  btn: ['确定']
											});
					        			}
					        		},
					        		error:function(){
					        			layer.confirm('出现错误，删除失败，请重试！', {
					        				icon: 6,
											  btn: ['确定']
										});
					        		},
					        	});   
							}, function(){ 
								layer.closeAll();
							});
						break;
						case 'edit':
							$("#oldpatName").val(data.patName);
					        $("#oldprofession").val(data.profession);
					        $("#oldagend").val(data.agend);
			 				$("#oldage").val(data.age);
			   				$("#oldorigin").val(data.origin);
		 					$("#oldnation").val(data.nation);
		  					$("#oldbeHospitalizedTime").val(data.beHospitalizedTime);
			 				$("#olddegreeOfEducation").val(data.degreeOfEducation);
			  				$("#oldaddress").val(data.address);
			   				$("#oldreligiousBelief").val(data.religiousBelief);
				 			$("#oldremarks").val(data.remarks);
			  				$("#oldmarriageStatus").val(data.marriageStatus);
			  				loadDepSelected("olddepId",data.depId,form);
			   				$("#olddepId").val()
			   				
							//loadClassSelected("classId",data.classId, form);
							//loadAgendSelected("stuAgend",data.stuAgend, form);
							layer.open({
		  						title:data.patName+"病人信息编辑",
		  						type: 1,
		  						area: ['500px', '500px'],
		  						skin: 'demo-class',
		  						btn:['确认保存'],
		  						//maxmin: true,//显示最大化最小化按钮
		  						//offset: 'b', 弹框的位置
		  						content: $('#div_editcollege'),
		  						btn1: function(index, layero){
		    						$.ajax({
					        		type: 'get',
					        		url: "patient/editpat",
					        		dataType: 'json',
					        		data:{
					        		 patName:$("#oldpatName").val().trim(),  
					        		profession:$("#oldprofession").val().trim(),  
					        		agend:$("#oldagend").val().trim(),
			 						age:$("#oldage").val().trim(),
			   						origin:$("#oldorigin").val().trim(), 
		 							nation:$("#oldnation").val().trim(), 
		  							beHospitalizedTime:$("#oldbeHospitalizedTime").val().trim(),
			 						degreeOfEducation:$("#olddegreeOfEducation").val().trim(), 
			  						address:$("#oldaddress").val().trim(), 
			   						religiousBelief:$("#oldreligiousBelief").val().trim(),
				 					remarks:$("#oldremarks").val().trim(), 
			  						marriageStatus:$("#oldmarriageStatus").val().trim(), 
			   						depId:$("#olddepId").val()
					        		},
					        		success:function(data){
					        			if(data.code == 0){
					        			
					        				layer.confirm(data.msg, {
					        				icon: 1,
											  btn: ['确定']
											}, function(){
												table.reload("classlist", { //此处是上文提到的 初始化标识id
									                where: {
									                	
									                },page: {
									                curr:1
									                }
									            });	
									            form.render();
												layer.closeAll();
											});          				 
					        			}
					        			else{
					        				layer.confirm(data.msg, {
					        					  icon: 7,
												  btn: ['确定']
											});
					        			}
					        		},
					        		error:function(){
					        			layer.confirm('出现错误，请重试！', {
					        				  icon: 6,
											  btn: ['确定']
										});
					        		},
					        	});  
		  						},
		  						cancel: function(){ 
		  							form.render();
		  						}
							});
							
						break;
					};
				});
				
				//添加按钮事件
		  		$("#addpatient").click(function(){ 
		  			loadSelect("dep","adddepId", form)
		  			layer.open({
		  				title:"添加病人",
		  				type: 1,
		  				area: ['400px', '600px'],
		  				skin: 'demo-class',
		  				btn:['添加'],
		  				//maxmin: true,//显示最大化最小化按钮
		  				//offset: 'b', 弹框的位置
		  				content: $('#div_addcollege'),
		  				btn1: function(index, layero){
		    				$.ajax({
					        		type: 'get',
					        		url: "patient/addpat",
					        		dataType: 'json',
					        		data:{
						        	    patName:$("#addpatName").val().trim(),  
						        		profession:$("#addprofession").val().trim(),  
						        		agend:$("#addagend").val().trim(),
				 						age:$("#addage").val().trim(),
				   						origin:$("#addorigin").val().trim(), 
			 							nation:$("#addnation").val().trim(), 
			  							beHospitalizedTime:$("#addbeHospitalizedTime").val().trim(),
				 						degreeOfEducation:$("#adddegreeOfEducation").val().trim(), 
				  						address:$("#addaddress").val().trim(), 
				   						religiousBelief:$("#addreligiousBelief").val().trim(),
					 					remarks:$("#addremarks").val().trim(), 
				  						marriageStatus:$("#addmarriageStatus").val().trim(), 
				   						depId:$("#adddepId").val()
					        		},
					        		success:function(data){
					        			if(data.code == 0){
					        				layer.confirm(data.msg, {
					        				icon: 1,
											  btn: ['确定']
											}, function(){
												table.reload("classlist", { //此处是上文提到的 初始化标识id
									                where: {
									                	
									                },page: {
									                curr:1
									                }
									            });	
									            $(".layui-input").val("");
												layer.closeAll();
											});          				 
					        			}
					        			else{
					        				layer.confirm(data.msg, {
					        					  icon: 7,
												  btn: ['确定']
											});
					        			}
					        		},
					        		error:function(){
					        			layer.confirm('出现错误，请重试！', {
					        				  icon: 6,
											  btn: ['确定']
										});
					        		},
					        	});  
		  				},
		  				cancel: function(){ 
		  					$(".layui-input").val("");
		  				}
					});
		  		})
			})
		</script>
	</body>
</html>